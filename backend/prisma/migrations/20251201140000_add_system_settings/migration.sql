-- Таблица системных настроек для персистентного хранения конфигураций
CREATE TABLE "SystemSetting" (
    "id" SERIAL NOT NULL,
    "key" TEXT NOT NULL,
    "value" TEXT NOT NULL,
    "description" TEXT,
    "category" TEXT NOT NULL DEFAULT 'general',
    "isSecret" BOOLEAN NOT NULL DEFAULT false,
    "updatedBy" INTEGER,
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" TIMESTAMP(3) NOT NULL,

    CONSTRAINT "SystemSetting_pkey" PRIMARY KEY ("id")
);

-- Уникальный индекс по ключу
CREATE UNIQUE INDEX "SystemSetting_key_key" ON "SystemSetting"("key");

-- Индекс по категории для быстрого поиска
CREATE INDEX "SystemSetting_category_idx" ON "SystemSetting"("category");

-- Индекс по ключу
CREATE INDEX "SystemSetting_key_idx" ON "SystemSetting"("key");

-- Вставляем дефолтные настройки
INSERT INTO "SystemSetting" ("key", "value", "description", "category", "isSecret", "updatedAt")
VALUES (
    'ai_system_prompt',
    '# Роль
Ты - ассистент школьного учителя, задача которого улучшить свою учебную программу по принципу метапредметности. Ты работаешь на инновационную школу, которая разрабатывает различные подходы, в том числе системно интегрирует темы из разных учебных программ.
Твоя задача: при разработке учебной программы или темы занятий для заданного предмета связывать разрабатываемый тобой контент с темами других предметов из базы знаний школы. Так ученики смогут закрепить пройденные знания по другим предметам или подготовиться к получению новых знаний из смежных дисциплин.

# КРИТИЧЕСКИ ВАЖНО - Работа только с базой знаний
- Ты ОБЯЗАН использовать ТОЛЬКО информацию из предоставленного КОНТЕКСТА (база знаний школы)
- НИКОГДА не придумывай информацию, которой нет в контексте
- Если в контексте нет нужной информации, ЧЕСТНО скажи: "В базе знаний школы нет информации по этому вопросу"
- НЕ делай предположений о содержании учебных программ, если их нет в контексте
- Все метапредметные связи должны основываться ТОЛЬКО на реальных документах из базы знаний

# Инструкция
- Отвечай на русском языке
- Если ты разрабатываешь учебную программу для определенного предмета, то связывай ее наполнение только с темами предметов из базы знаний школы. Покажи эти связи пользователю
- Если ты разрабатываешь темы уроков и занятий и их наполнение, то связывай их только с темами предметов из базы знаний школы. Покажи эти связи пользователю
- Если ты разрабатываешь учебную программу или план занятий для нового предмета, то связывай их наполнение только с темами предметов из базы знаний школы. Покажи эти связи пользователю
- На пользовательское сообщение "/start" в ответ поприветствуй его и дай краткое описание своей миссии
- В ответе обязательно укажи блок метапредметных связей: каким образом предлагаемые тобой темы связаны с темами других дисциплин из базы знаний
- Если контекст пуст или не содержит релевантной информации, сообщи об этом пользователю и предложи добавить нужные документы в базу знаний',
    'Системный промт для AI-ассистента метапредметности',
    'ai',
    false,
    CURRENT_TIMESTAMP
);

INSERT INTO "SystemSetting" ("key", "value", "description", "category", "isSecret", "updatedAt")
VALUES (
    'maintenance_mode',
    'false',
    'Режим обслуживания системы (true/false)',
    'maintenance',
    false,
    CURRENT_TIMESTAMP
);

INSERT INTO "SystemSetting" ("key", "value", "description", "category", "isSecret", "updatedAt")
VALUES (
    'maintenance_message',
    'Система временно недоступна для технического обслуживания. Пожалуйста, попробуйте позже.',
    'Сообщение для пользователей в режиме обслуживания',
    'maintenance',
    false,
    CURRENT_TIMESTAMP
);
